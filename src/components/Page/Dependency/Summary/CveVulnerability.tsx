import { ISeverity, ICve, ILicense } from '../../../../model'
import { getApplicabilityImg, getSeverityImage } from '../../../../utils/utils'
import css from './CveVulnerability.module.css'

export interface Props {
  id: string;
  dependencyName: string;
  dependencyVersion: string;
  cve?: ICve;
  severity: ISeverity;
  license?: ILicense;
  type: string;
  fixedVersion?: string[];
  jfrogSeverity?: ISeverity;
}

const CveVulnerability = (props: Props): JSX.Element => {
	const optionalDetails = () => {
		let contextualAnalysis = <></>
		let cve = <></>
		let license = <></>
		let fixedVersion = <></>
		let jfrogSeverity = <></>
		if (props.jfrogSeverity) {
			jfrogSeverity = (
				<li>
					<div className={css.container}>
						<span>JFrog severity: </span>
						<img
							className={css.image}
							src={getSeverityImage(props.jfrogSeverity)}
							alt="severity level"/>
						<>{props.jfrogSeverity}</>
					</div>
				</li>
			)
		}

		if (props.cve?.applicably !== undefined) {
			contextualAnalysis = (
				<li>
					<div className={css.container}>
						<span>Contextual Analysis: </span>
						<img
							src={getApplicabilityImg(props.cve.applicably)}
							alt="severity level"/>
						{props.cve.applicably
							? 'The CVE is Applicable'
							: 'The CVE is not Applicable'}
					</div>
				</li>
			)
		}

		if (props.cve?.cvssV2Score || props.cve?.cvssV3Score) {
			cve = (
				<li>
					<span>CVSS score: </span>
					{props.cve?.cvssV2Score && <div className={css.redBox}>{props.cve.cvssV2Score} (v2)</div>}
					{props.cve?.cvssV3Score && <label className={css.yellowBox}> {props.cve.cvssV3Score} (v3)</label>}
				</li>
			)
		}

		if (props.license) {
			license = (
				<li>
					<span>License: </span>
					{props.license.name}
				</li>
			)
		}

		if (props.fixedVersion) {
			fixedVersion = (
				<li>
					<span>Fixed version: </span>
					{props.fixedVersion.join(', ')}
				</li>
			)
		}

		return (
			<>
				{jfrogSeverity}
				{contextualAnalysis}
				{cve}
				{license}
				{fixedVersion}
			</>
		)
	}

	return (
		<>
			<li>
				<span>ID: </span>
				{props.id}
			</li>
			<li>
				<span>Name: </span>
				{props.dependencyName}
			</li>
			<li>
				<span>Version: </span>
				{props.dependencyVersion}
			</li>
			<li>
				<span>Severity: </span>
				{props.severity}
			</li>
			<li>
				<span>Type: </span>
				{props.type}
			</li>
			{optionalDetails()}
		</>
	)
}

export default CveVulnerability